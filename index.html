<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">
  <script type="text/javascript" src="javascripts/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>
  <script type="text/javascript" src="amrnb.js"></script>

  <title>Opencore-amr-js</title>
  <meta name="description" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Opencore-amr-js</h1>
    </header>
    <div id="container">
      <p class="tagline"></p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/yxl/opencore-amr-js/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/yxl/opencore-amr-js/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/yxl/opencore-amr-js" class="code">View Opencore-amr-js on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">

          <h2>Decode amr file and play</h2>
          <p id="sample-amr">
              <button>Play</button> <a href="yuan.amr">yuan.amr</a>
          </p>
          <p>
              Select a local file and play: <input type="file" id="amr-file" accept=".amr">
          </p>
          <h2>Encode audio to amr file and play</h2>
          <p id="sample-audio">
              <button>Encode &amp; Play</button> <a href="hello.ogg">hello.ogg</a>
          </p>
          <p>
              Select a local file to encode and play: <input type="file" id="audio-file" accept="audio/*">
          </p>
          <script>
              function E(selector) {
                  return document.querySelector(selector);
              }

              E('#sample-amr > button').onclick = function() {
                  var xhr = new XMLHttpRequest();
                  xhr.open('GET', E('#sample-amr > a').href);
                  xhr.responseType = 'blob';
                  xhr.onload = function() {
                      playAmrBlob(this.response);
                  };
                  xhr.send();
              };

              E('#amr-file').onchange = function() {
                  playAmrBlob(this.files[0]);
              };

              E('#sample-audio > button').onclick = function() {
                  var xhr = new XMLHttpRequest();
                  xhr.open('GET', E('#sample-audio > a').href);
                  xhr.responseType = 'blob';
                  xhr.onload = function() {
                      convertAudioBlob(this.response);
                  };
                  xhr.send();
              };

              E('#audio-file').onchange = function() {
                  convertAudioBlob(this.files[0]);
              };

              function readBlob(blob, callback) {
                  var reader = new FileReader();
                  reader.onload = function (e) {
                      var data = new Uint8Array(e.target.result);
                      callback(data);
                  };
                  reader.readAsArrayBuffer(blob);
              }

              function playAmrBlob( blob, callback) {
                  readBlob(blob, function(data) {
                    playAmrArray(data);
                  });
              }

              function convertAudioBlob(blob) {
                  readBlob(blob, function(data) {
                    var ctx = new AudioContext();
                    ctx.decodeAudioData(data.buffer, function(audioBuffer) {
                      var pcm = new Float32Array(audioBuffer.length);
                      audioBuffer.copyFromChannel(pcm, 0, 0);
                      var amr = AMR.encode(pcm, audioBuffer.sampleRate, 7);
                      playAmrArray(amr);
                    });
                  });
              }

              function playAmrArray(array) {
                var samples = AMR.decode(array);
                if (!samples) {
                    alert('Failed to decode!');
                    return;
                }
                playPcm(samples);
              }

              function playPcm(samples) {
                  var ctx = new AudioContext();
                  var src = ctx.createBufferSource();
                  var buffer = ctx.createBuffer(1, samples.length, 8000);
                  buffer.copyToChannel(samples, 0, 0);
                  src.buffer = buffer;
                  src.connect(ctx.destination);
                  src.start();
              }
          </script>

        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/yxl" class="avatar"><img src="https://avatars2.githubusercontent.com/u/1262683?v=3&amp;s=60" width="48" height="48"></a> <a href="https://github.com/yxl">yxl</a> maintains <a href="https://github.com/yxl/opencore-amr-js">Opencore-amr-js</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="http://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/yxl/opencore-amr-js/tarball/master" class="tar">tar</a><a href="https://github.com/yxl/opencore-amr-js/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
